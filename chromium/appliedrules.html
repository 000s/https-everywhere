<link href="chrome://resources/css/checkbox.css" rel="stylesheet" type="text/css"/>
<style type="text/css" rel="stylesheet">
<!--
body {
  /* based off Chrome's WebUI */
  font-family: 'Segoe UI', Tahoma, sans-serif;
  font-size: 75%;
  cursor: default;
}

a {
  cursor: auto;
  white-space: nowrap;
}

#About {
  background-image: url('icon48.png');
  background-repeat: no-repeat;
  min-width: 9em;
  min-height: 48px;    /* icon size */
  padding-left: 54px;  /* icon size + 6px padding */
  padding-bottom: 7px;
  border-bottom: 1px solid rgb(205, 205, 205);
}

div.rule {
  white-space: nowrap;
  margin: 8px 0;
}

.rule > * {
  vertical-align: middle;
}

/* cb_block */
.rule > div {
  display: inline-block;
  width: 54px;
  text-align: right;
}

/* checkbox */
.rule > div > input {
  margin-right: 8px;
}

.rule > label {
  margin-left: 0;
  -webkit-margin-start: 0 !important; /* override checkbox.css */
}

input[type="checkbox"]:checked::before {
  top: 3px; /* fix WebUI check not being centered in box */
}
--->
</style>

<div id="About"><a href="https://www.eff.org/https-everywhere" target="_blank">HTTPS Everywhere</a> rulesets applied to this webpage:</div>
<div id="AppliedRules"></div>

<script>
var backgroundPage = chrome.extension.getBackgroundPage();
var appliedDiv = document.getElementById("AppliedRules");
var tab = null;

function toggleRuleLine(checkbox, ruleset) {
  ruleset.active = checkbox.checked;

  if (ruleset.active != ruleset.default_state) {
    localStorage[ruleset.name] = ruleset.active;
  } else {
    delete localStorage[ruleset.name];
  }
}

function createRuleLine(ruleset) {
  // parent block for line
  var line = document.createElement('div');
  line.className = 'rule checkbox';

  // checkbox
  var checkbox = document.createElement('input');
  checkbox.type = 'checkbox';
  checkbox.id = ruleset.name; // FIXME: is uniqueness guaranteed?
  checkbox.checked = ruleset.active;
  checkbox.onchange = function(ev) { toggleRuleLine(checkbox, ruleset); };

  // checkbox container (used for spacing)
  var cb_block = document.createElement('div');
  cb_block.appendChild(checkbox);

  // label for checkbox
  var label = document.createElement('label');
  label.innerText = ruleset.name;
  label.htmlFor = ruleset.name;

  line.appendChild(cb_block);
  line.appendChild(label);

  return line;
}

function gotTab(tab) {
  var rulesets = backgroundPage.activeRulesets.getRulesets(tab.id);

  for (r in rulesets) {
    appliedDiv.appendChild(createRuleLine(rulesets[r]));
  }
}

chrome.tabs.getSelected(null, gotTab);


</script>
