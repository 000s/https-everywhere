<!--
	Other Google rulesets:

		- 2mdn.net.xml
		- Admeld.xml
		- ChannelIntelligence.com.xml
		- Doubleclick.net.xml
		- FeedBurner.xml
		- Google.org.xml
		- GoogleAPIs.xml
		- Google_App_Engine.xml
		- GoogleImages.xml
		- Ingress.xml
		- Meebo.xml
		- Orkut.xml
		- Postini.xml


	Nonfunctional domains:

		- books.google.com			(redirects to google.cctld)
		- feedproxy.google.com			(404, valid cert)
		- knol.google.com			(most paths redirect to google.cctld)
		- scholar.google.com			(redirects to http)
		- safebrowsing.clients.google.com	(mismatch; 404)
		- scholar.google.fr			(redirects to http)
		- buttons.googlesyndication.com *

	* 404, valid cert


	Nonfunctional google.com paths:

		- analytics	(redirects to http)
		- imgres
		- hangouts	(404)
		- patents/\w\w\d+\?hl=\w\w


	Problematic domains:

		- www.goo.gl		(404; mismatched, CN: *.google.com)

		- google.com subdomains:

			- books		(googlebooks/, images/, & intl/ 404, but works when rewritten to www)
			- knoll		(404, valid cert)
			- trends *

		- news.google.cctld	(redirects to http, valid cert)

	* 404, valid cert


	Partially covered domains:

		- google.com subdomains:

			- (www.)
			- books		(some pages redirect to http)
			- news		(→ www)

		- *.googleusercontent.com	(*-opensocial excluded)


	Fully covered domains:

		- lh[3-6].ggpht.com

		- (www.)goo.gl		(www → ^)

		- google.com subdomains:

			- accounts
			- adwords
			- apis
			- appengine
			- books
			- calendar
			- checkout
			- chrome
			- clients[12]
			- code
			- *.corp
			- developers
			- dl
			- docs
			- docs\d
			- drive
			- encrypted
			- encrypted-tbn[123]
			- feedburner
			- fiber
			- finance
			- glass
			- groups
			- health
			- history
			- hostedtalkgadget
			- id
			- investor
			- knol
			- knoll		(→ knol)
			- lh\d
			- mail
			- chatenabled.mail
			- pack
			- picasaweb
			- pki
			- play
			- plus
			- plusone
			- productforums
			- profiles
			- safebrowsing-cache
			- cert-test.sandbox
			- plus.sandbox
			- sb-ssl
			- script
			- security
			- servicessites
			- sites
			- spreadsheets
			- spreadsheets\d
			- support
			- talk
			- talkgadget
			- tbn2			(→ encrypted-tbn2)
			- tools
			- translate
			- trends		(→ www)

		- partner.googleadservices.com
		- (www.)googlecode.com
		- *.googlecode.com	(per-project subdomains)
		- googlesource.com
		- *.googlesource.com
		- pagead2.googlesyndication.com
		- tpc.googlesyndication.com
		- mail-attachment.googleusercontent.com


	ssl.google-analytics.com/ga.js sets __utm\w wildcard
	cookies on whichever domain it is loaded from.


	XXX: Needs more testing
-->
<ruleset name="Google Services">

	<target host="*.ggpht.com" />
	<target host="gmail.com" />
	<target host="www.gmail.com" />
	<target host="goo.gl" />
	<target host="www.goo.gl" />
	<target host="google.*" />
	<target host="news.google.*" />
		<exclusion pattern="^http://(?:news\.)?google\.com/(?:archivesearch|newspapers)" />
	<target host="www.google.*" />
	<target host="google.co.*" />
	<target host="*.google.ca" />
	<target host="news.google.co.*" />
	<target host="www.google.co.*" />
	<target host="google.com" />
	<target host="*.google.com" />
		<exclusion pattern="^http://(?:www\.)?google\.com/analytics/*(?:$|\?|[^/]+(?:\?.*)?$)" />
		<exclusion pattern="^http://books\.google\.com/(?!books/(?:\w+\.js|css/|javascript/)|favicon\.ico|googlebooks/|images/|intl/)" />
	<target host="news.google.com.*" />
	<target host="google.com.*" />
	<target host="www.google.com.*" />
	<target host="groups.google.de" />
	<target host="partner.googleadservices.com" />
	<target host="googlecode.com" />
	<target host="*.googlecode.com" />
	<target host="googlemail.com" />
	<target host="www.googlemail.com" />
	<target host="googlesource.com" />
	<target host="*.googlesource.com" />
	<target host="*.googlesyndication.com" />
	<target host="www.googletagservices.com" />
	<target host="googleusercontent.com" />
	<target host="*.googleusercontent.com" />


	<!--	Can we enable any of these wildcard cookies safely?
									-->
	<!--securecookie host="^\.google\.com$" name="^(NID|PREF)$" /-->
	<securecookie host="^(?:accounts|\.code|login\.corp|developers|docs|\d\.docs|fiber|mail|plus|support)\.google\.[\w\.]{2,6}$" name=".+" />
	<securecookie host="^mail-attachment\.googleusercontent\.com$" name=".+" />
	<securecookie host="^ssl\.google-analytics\.com$" name=".+" />
	<securecookie host="^gmail\.com$" name=".+" />
	<securecookie host="^www\.gmail\.com$" name=".+" />
	<securecookie host="^googlemail\.com$" name=".+" />
	<securecookie host="^www\.googlemail\.com$" name=".+" />

	<!--    - lh 3-6 exist


		- All appear identical
		- Identical to lh\d.googleusercontent.com
					-->
	<rule from="^http://lh(\d)\.ggpht\.com/"
		to="https://lh$1.ggpht.com/" />

	<rule from="^http://lh(\d)\.google\.ca/"
		to="https://lh$1.google.ca/" />


	<rule from="^http://(?:www\.)?goo\.gl/"
		to="https://goo.gl/" />

	<!--	Protocol-relative links from books/css/:
								-->
	<rule from="^https?://books\.google\.com/googlebooks/"
		to="https://www.google.com/googlebooks/" />

	<rule from="^http://books\.google\.com/(googlebooks|(?:intl/en/)?images)/"
		to="https://www.google.com/$1/" />

	<rule from="^http://books\.google\.com/i(mages|ntl)/"
		to="https://www.google.com/i$1/" />

	<rule from="^http://(?:www\.)?google\.c(a|o\.in|o\.uk)/(contacts|prdhp|products|shopping)"
		 to="https://www.google.c$1/$2" />

	<rule from="^http://(?:www\.)?google((?:\.com?)?(?:\.[^/@:][^/@:])?)/(accounts|adplanner|ads|css|hostednews|images|intl|js|landing|logos|tools|googleblogs|s2|support|transparencyreport)/"
		 to="https://www.google$1/$2/" />

	<rule from="^http://(?:www\.)?google(?:\.com?)?(?:\.[^/@:][^/@:])?/(calendar|coop|dictionary|trends|url)"
		 to="https://www.google.com/$1" />

	<rule from="^http://(?:www\.)?google(?:\.com?)?(?:\.[^/@:][^/@:])?/(?:cse|custom)"
		 to="https://www.google.com/cse" />

	<rule from="^http://(?:www\.)?google\.com/(\+|accounts|doodles|doubleclick|extern_js|googlebooks|help|images|moderator|newproducts|nexus|phone|postini|reader|settings|videotargeting|safebrowsing)/"
		 to="https://www.google.com/$1/" />

	<rule from="^http://(?:www\.)?google\.com/(appsstatus|buzz|contacts|culturalinstitute|favicon\.ico|glass|insights|mapmaker|news|patents/licensing/|prdhp|products|shopping|webfonts)"
		 to="https://www.google.com/$1" />

	<rule from="^http://(?:www\.)?google\.com/(analytics|finance|goodtoknow|ig|policies|urchin)($|\?|/)"
		to="https://www.google.com/$1$2" />

	<!--	This worked for a while but seems to be unstable.

	<rule from="^http://(?:www\.)?google((?:\.com?)?(?:\.[^/@:][^/@:])?)/products"
		to="https://www.google$1/products" /-->

	<rule from="^http://(?:www\.)?google((?:\.com?)?(?:\.[^/@:][^/@:])?)/profiles"
		to="https://www.google$1/profiles" />

	<rule from="^http://(www\.)?g(oogle)?mail\.com/"
		to="https://$1g$2mail.com/" />

	<rule from="^http://(accounts|adwords|apis|appengine|books|calendar|checkout|chrome|clients[12]|code|[\w\-]+\.corp|developers|dl|docs\d?|drive|encrypted|encrypted-tbn[123]|feedburner|fiber|finance|glass|groups|health|history|(?:hosted)?talkgadget|id|investor|lh\d|(?:chatenabled\.)?mail|pack|picasaweb|pki|play|plus(?:\.sandbox)?|plusone|productforums|profiles|safebrowsing-cache|cert-test\.sandbox|sb-ssl|script|security|servicessites|sites|spreadsheets\d?|support|talk|tools|translate)\.google\.com/"
		to="https://$1.google.com/" />

	<rule from="^http://scholar\.google\.(?:com|co\.\w\w|\w\w)/intl/(\w\w)/scholar/images/"
		to="https://www.google.com/intl/$1/scholar/images/" />

	<rule from="^http://(?:encrypted-)?tbn2\.google\.com/"
		to="https://encrypted-tbn2.google.com/" />


	<rule from="^http://([^/:@\.]+)\.google\.ca/finance"
		 to="https://$1.google.ca/finance" />

	<rule from="^http://(?:www\.)?google\.co\.uk/finance"
		 to="https://www.google.co.uk/finance" />

	<rule from="^http://finance\.google\.co\.uk/"
		 to="https://finance.google.co.uk/" />


	<rule from="^http://knoll?\.google\.com/"
		to="https://knol.google.com/" />


	<rule from="^http://news\.google(?:\.com?)?(?:\.[^/@:][^/@:])?/(?:$|news|newshp)"
		to="https://www.google.com/news" />

	<rule from="^http://trends\.google\.com/"
		 to="https://www.google.com/trends" />


	<rule from="^http://groups\.google\.de/"
		to="https://groups.google.de/" />


	<rule from="^http://([^/:@]+\.)?googlecode\.com/"
		 to="https://$1googlecode.com/" />

	<rule from="^http://([^\./]\.)?googlesource\.com/"
		to="https://$1googlesource.com/" />


	<rule from="^http://partner\.googleadservices\.com/"
		 to="https://partner.googleadservices.com/" />

	<rule from="^http://(pagead2|tpc)\.googlesyndication\.com/"
		 to="https://$1.googlesyndication.com/" />

	<!--	!www doesn't exist.
					-->
	<rule from="^http://www\.googletagservices\.com/tag/js/"
		to="https://www.googletagservices.com/tag/js/" />


	<rule from="^http://([^@:\./]+)\.googleusercontent\.com/"
		to="https://$1.googleusercontent.com/" />
	
  <!-- Necessary for the Followers widget https://trac.torproject.org/projects/tor/ticket/7294 -->
  <exclusion pattern="http://([^@:\./]+)-opensocial\.googleusercontent\.com" />

</ruleset>
