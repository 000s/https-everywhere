<!--
	Other Google rulesets:

		- 2mdn.net.xml
		- Admeld.xml
		- Android.xml
		- ChannelIntelligence.com.xml
		- Chrome_Status.com.xml
		- Chromium.org.xml
		- Doubleclick.net.xml
		- FeedBurner.xml
		- Go_Lang.org.xml
		- Google.com_Subdomains.xml
		- Google.org.xml
		- GoogleAPIs.xml
		- Google_App_Engine.xml
		- GoogleImages.xml
		- GoogleServices_Simple.xml (Simple rules that normally would reside here are in this ruleset)
		- GoogleShopping.xml
		- Ingress.xml
		- Made_with_Code.com.xml
		- Meebo.xml
		- Orkut.xml
		- Polymer-Project.org.xml
		- Postini.xml
		- WebM_Project.org.xml
		- With_Google.com.xml

	Nonfunctional google.com paths:

		- analytics	(redirects to http)
		- imgres
		- gadgets *
		- u/		(404)

	* Redirects to http


	Problematic domains:

		- www.goo.gl		(404; mismatched, CN: *.google.com)

		- www.news.google.ca ²

		- news.google.cctld **
		- scholar.google.cctld **
		- *-opensocial.googleusercontent.com ***

	² Mismatched, CN: google.com
	**** $ 404s
	* 404, valid cert
	** Redirects to http, valid cert
	*** Breaks followers widget - https://trac.torproject.org/projects/tor/ticket/7294


	Partially covered domains:

		- google.cctld subdomains:

			- scholar	(→ www)

		- *.googleusercontent.com	(*-opensocial excluded)


	Fully covered domains:

		- lh[3-6].ggpht.com
		- (www.)goo.gl		(www → ^)

		- partner.googleadservices.com
		- (www.)googlecode.com
		- *.googlecode.com	(per-project subdomains)
		- googlesource.com
		- *.googlesource.com
		- pagead2.googlesyndication.com
		- tpc.googlesyndication.com
		- mail-attachment.googleusercontent.com
		- webcache.googleusercontent.com


	XXX: Needs more testing

-->
<ruleset name="Google Services">
	<target host="*.ggpht.com" />
	<target host="gmail.com" />
	<target host="www.gmail.com" />
	<target host="goo.gl" />
	<target host="www.goo.gl" />
	<target host="google.*" />
	<target host="accounts.google.*" />
	<target host="adwords.google.*" />
	<target host="finance.google.*" />
	<target host="groups.google.*" />
	<target host="it.google.*" />
	<target host="news.google.*" />
		<exclusion pattern="^http://(news\.)?google\.((?:com?\.)?\w{2,3})/(archivesearch|newspapers)" />
			<test url="http://news.google.ca/archivesearch" />
			<test url="http://news.google.com/archivesearch" />
			<test url="http://news.google.com.au/archivesearch" />
			<test url="http://news.google.ca/newspapers" />
			<test url="http://news.google.com/newspapers" />
			<test url="http://news.google.com.au/newspapers" />
	<target host="picasaweb.google.*" />
	<target host="scholar.google.*" />
	<target host="www.google.*" />
	<target host="*.google.ca" />
	<target host="google.co.*" />
	<target host="accounts.google.co.*" />
	<target host="adwords.google.co.*" />
	<target host="finance.google.co.*" />
	<target host="groups.google.co.*" />
	<target host="id.google.co.*" />
	<target host="news.google.co.*" />
	<target host="picasaweb.google.co.*" />
	<target host="scholar.google.co.*" />
	<target host="www.google.co.*" />
	<target host="google.com" />
	<target host="*.google.com" />
		<exclusion pattern="^http://(www\.)?google\.com/analytics/*(?:/[^/]+)?(?:\?.*)?$" />
		<exclusion pattern="^http://cbks0\.google\.com/(?:$|\?)" />
		<exclusion pattern="^http://gg\.google\.com/(?!csi(?:$|\?))" />
	<target host="google.com.*" />
	<target host="accounts.google.com.*" />
	<target host="adwords.google.com.*" />
	<target host="groups.google.com.*" />
	<target host="id.google.com.*" />
	<target host="news.google.com.*" />
	<target host="picasaweb.google.com.*" />
	<target host="scholar.google.com.*" />
	<target host="www.google.com.*" />
	<target host="partner.googleadservices.com" />
	<target host="googlecode.com" />
	<target host="*.googlecode.com" />
	<target host="googlemail.com" />
	<target host="www.googlemail.com" />
	<target host="googlesource.com" />
	<target host="*.googlesource.com" />
	<target host="*.googlesyndication.com" />
	<target host="www.googletagservices.com" />
	<!--target host="googleusercontent.com" doesn't work /-->
	<target host="*.googleusercontent.com" />
	<target host="*.corp.googleusercontent.com" />
		<!--
			Necessary for the Followers widget:

				 https://trac.torproject.org/projects/tor/ticket/7294
											-->
		<exclusion pattern="http://[^@:\./]+-opensocial\.googleusercontent\.com" />


	<!--	Not secured by server:
					-->
	<!--securecookie host="^\.google\.com$" name="^(APISID|HSID|NID|PREF|SID)$" /-->
	<!--
		Can we secure any of these wildcard cookies safely?
									-->
	<!--securecookie host="^\.google\.com$" name="^(hl|I4SUserLocale|NID|PREF|S)$" /-->
	<!--securecookie host="^\.google\.[\w.]{2,6}$" name="^(hl|I4SUserLocale|NID|PREF|S|S_awfe)$" /-->
	<securecookie host="^(?:accounts|adwords|\.code|login\.corp|developers|docs|\d\.docs|fiber|mail|picasaweb|plus|\.?productforums|support)\.google\.[\w.]{2,6}$" name=".+" />
	<securecookie host="^www\.google\.com$" name="^GoogleAccountsLocale_session$" />
	<securecookie host="^mail-attachment\.googleusercontent\.com$" name=".+" />

	<!--    - lh 3-6 exist
		- All appear identical
		- Identical to lh\d.googleusercontent.com
					-->
	<rule from="^http://lh(\d)\.ggpht\.com/"
		to="https://lh$1.ggpht.com/" />
		<test url="http://lh3.ggpht.com/" />
		<test url="http://lh4.ggpht.com/" />
		<test url="http://lh5.ggpht.com/" />
		<test url="http://lh6.ggpht.com/" />

	<rule from="^http://(www\.)?goo\.gl/"
		to="https://goo.gl/" />
		<test url="http://www.goo.gl/" />
		<test url="http://goo.gl/" />

	<!-- Google CSE -->
	<rule from="^http://(?:www\.)?google\.(?:com?\.)?\w{2,3}/custom"
		 to="https://www.google.com/cse" />
		<test url="http://www.google.ca/custom" />
		<test url="http://www.google.com/custom" />
		<test url="http://www.google.com.au/custom" />

	<!--	Paths that work on all in google.*
							-->
	<rule from="^http://(?:www\.)?google\.((?:com?\.)?\w{2,3})/"
		 to="https://www.google.$1/" />
		<test url="http://www.google.ca/accounts" />
		<test url="http://www.google.com/accounts" />
		<test url="http://www.google.com.au/accounts" />
		<test url="http://www.google.ca/adplanner" />
		<test url="http://www.google.com/adplanner" />
		<test url="http://www.google.com.au/adplanner" />
		<test url="http://www.google.ca/ads" />
		<test url="http://www.google.com/ads" />
		<test url="http://www.google.com.au/ads" />
		<test url="http://www.google.ca/adsense" />
		<test url="http://www.google.com/adsense" />
		<test url="http://www.google.com.au/adsense" />
		<test url="http://www.google.ca/adwords" />
		<test url="http://www.google.com/adwords" />
		<test url="http://www.google.com.au/adwords" />
		<test url="http://www.google.ca/analytics" />
		<test url="http://www.google.com/analytics" />
		<test url="http://www.google.com.au/analytics" />
		<test url="http://www.google.ca/bookmarks" />
		<test url="http://www.google.com/bookmarks" />
		<test url="http://www.google.com.au/bookmarks" />
		<test url="http://www.google.ca/books" />
		<test url="http://www.google.com/books" />
		<test url="http://www.google.com.au/books" />
		<test url="http://www.google.ca/chrome" />
		<test url="http://www.google.com/chrome" />
		<test url="http://www.google.com.au/chrome" />
		<test url="http://www.google.ca/chromecast" />
		<test url="http://www.google.com/chromecast" />
		<test url="http://www.google.com.au/chromecast" />
		<test url="http://www.google.ca/contacts" />
		<test url="http://www.google.com/contacts" />
		<test url="http://www.google.com.au/contacts" />
		<test url="http://www.google.ca/coop" />
		<test url="http://www.google.com/coop" />
		<test url="http://www.google.com.au/coop" />
		<test url="http://www.google.ca/cse" />
		<test url="http://www.google.com/cse" />
		<test url="http://www.google.com.au/cse" />
		<test url="http://www.google.ca/css" />
		<test url="http://www.google.com/css" />
		<test url="http://www.google.com.au/css" />
		<test url="http://www.google.ca/culturalinstitute" />
		<test url="http://www.google.com/culturalinstitute" />
		<test url="http://www.google.com.au/culturalinstitute" />
		<test url="http://www.google.ca/doodles" />
		<test url="http://www.google.com/doodles" />
		<test url="http://www.google.com.au/doodles" />
		<test url="http://www.google.ca/earth" />
		<test url="http://www.google.com/earth" />
		<test url="http://www.google.com.au/earth" />
		<test url="http://www.google.ca/favicon.ico" />
		<test url="http://www.google.com/favicon.ico" />
		<test url="http://www.google.com.au/favicon.ico" />
		<test url="http://www.google.ca/finance" />
		<test url="http://www.google.com/finance" />
		<test url="http://www.google.com.au/finance" />
		<test url="http://www.google.ca/get" />
		<test url="http://www.google.com/get" />
		<test url="http://www.google.com.au/get" />
		<test url="http://www.google.ca/goodtoknow" />
		<test url="http://www.google.com/goodtoknow" />
		<test url="http://www.google.com.au/goodtoknow" />
		<test url="http://www.google.ca/googleblogs" />
		<test url="http://www.google.com/googleblogs" />
		<test url="http://www.google.com.au/googleblogs" />
		<test url="http://www.google.ca/grants" />
		<test url="http://www.google.com/grants" />
		<test url="http://www.google.com.au/grants" />
		<test url="http://www.google.ca/green" />
		<test url="http://www.google.com/green" />
		<test url="http://www.google.com.au/green" />
		<test url="http://www.google.ca/hangouts" />
		<test url="http://www.google.com/hangouts" />
		<test url="http://www.google.com.au/hangouts" />
		<test url="http://www.google.ca/hostednews" />
		<test url="http://www.google.com/hostednews" />
		<test url="http://www.google.com.au/hostednews" />
		<test url="http://www.google.ca/images" />
		<test url="http://www.google.com/images" />
		<test url="http://www.google.com.au/images" />
		<test url="http://www.google.ca/intl" />
		<test url="http://www.google.com/intl" />
		<test url="http://www.google.com.au/intl" />
		<test url="http://www.google.ca/js" />
		<test url="http://www.google.com/js" />
		<test url="http://www.google.com.au/js" />
		<test url="http://www.google.ca/landing" />
		<test url="http://www.google.com/landing" />
		<test url="http://www.google.com.au/landing" />
		<test url="http://www.google.ca/logos" />
		<test url="http://www.google.com/logos" />
		<test url="http://www.google.com.au/logos" />
		<test url="http://www.google.ca/mapmaker" />
		<test url="http://www.google.com/mapmaker" />
		<test url="http://www.google.com.au/mapmaker" />
		<test url="http://www.google.ca/mobile" />
		<test url="http://www.google.com/mobile" />
		<test url="http://www.google.com.au/mobile" />
		<test url="http://www.google.ca/newproducts" />
		<test url="http://www.google.com/newproducts" />
		<test url="http://www.google.com.au/newproducts" />
		<test url="http://www.google.ca/news" />
		<test url="http://www.google.com/news" />
		<test url="http://www.google.com.au/news" />
		<test url="http://www.google.ca/nexus" />
		<test url="http://www.google.com/nexus" />
		<test url="http://www.google.com.au/nexus" />
		<test url="http://www.google.ca/patents" />
		<test url="http://www.google.com/patents" />
		<test url="http://www.google.com.au/patents" />
		<test url="http://www.google.ca/policies" />
		<test url="http://www.google.com/policies" />
		<test url="http://www.google.com.au/policies" />
		<test url="http://www.google.ca/prdhp" />
		<test url="http://www.google.com/prdhp" />
		<test url="http://www.google.com.au/prdhp" />
		<test url="http://www.google.ca/profiles" />
		<test url="http://www.google.com/profiles" />
		<test url="http://www.google.com.au/profiles" />
		<test url="http://www.google.ca/products" />
		<test url="http://www.google.com/products" />
		<test url="http://www.google.com.au/products" />
		<test url="http://www.google.ca/reader" />
		<test url="http://www.google.com/reader" />
		<test url="http://www.google.com.au/reader" />
		<test url="http://www.google.ca/s2" />
		<test url="http://www.google.com/s2" />
		<test url="http://www.google.com.au/s2" />
		<test url="http://www.google.ca/script" />
		<test url="http://www.google.com/script" />
		<test url="http://www.google.com.au/script" />
		<test url="http://www.google.ca/settings" />
		<test url="http://www.google.com/settings" />
		<test url="http://www.google.com.au/settings" />
		<test url="http://www.google.ca/shopping" />
		<test url="http://www.google.com/shopping" />
		<test url="http://www.google.com.au/shopping" />
		<test url="http://www.google.ca/support" />
		<test url="http://www.google.com/support" />
		<test url="http://www.google.com.au/support" />
		<test url="http://www.google.ca/tisp" />
		<test url="http://www.google.com/tisp" />
		<test url="http://www.google.com.au/tisp" />
		<test url="http://www.google.ca/tools" />
		<test url="http://www.google.com/tools" />
		<test url="http://www.google.com.au/tools" />
		<test url="http://www.google.ca/transparencyreport" />
		<test url="http://www.google.com/transparencyreport" />
		<test url="http://www.google.com.au/transparencyreport" />
		<test url="http://www.google.ca/trends" />
		<test url="http://www.google.com/trends" />
		<test url="http://www.google.com.au/trends" />
		<test url="http://www.google.ca/urchin" />
		<test url="http://www.google.com/urchin" />
		<test url="http://www.google.com.au/urchin" />
		<test url="http://www.google.ca/webmasters" />
		<test url="http://www.google.com/webmasters" />
		<test url="http://www.google.com.au/webmasters" />

	<!--	Paths that only exist/work on .com
							-->
	<rule from="^http://(www\.)?google\.com/"
			to="https://www.google.com/" />
		<test url="http://google.com/" />
		<test url="http://www.google.com/" />
		<test url="http://www.google.com/+" />
		<test url="http://www.google.com/appsstatus" />
		<test url="http://www.google.com/buzz" />
		<test url="http://www.google.com/chat" />
		<test url="http://www.google.com/chromeos" />
		<test url="http://www.google.com/extern_js" />
		<test url="http://www.google.com/glass" />
		<test url="http://www.google.com/googlebooks" />
		<test url="http://www.google.com/ig" />
		<test url="http://www.google.com/insights" />
		<test url="http://www.google.com/moderator" />
		<test url="http://www.google.com/phone" />
		<test url="http://www.google.com/safebrowsing" />
		<test url="http://www.google.com/videotargetting" />
		<test url="http://www.google.com/webfonts" />

	<!--	Subdomains that work on all in google.*
							-->
	<rule from="^http://(accounts|adwords|finance|groups|id|lh\d|m|picasaweb|)\.google\.((?:com?\.)?\w{2,3})/"
		to="https://$1.google.$2/" />
		<test url="http://accounts.google.ca/" />
		<test url="http://accounts.google.com/" />
		<test url="http://accounts.google.com.au/" />
		<test url="http://adwords.google.ca/" />
		<test url="http://adwords.google.com/" />
		<test url="http://adwords.google.com.au/" />
		<test url="http://finance.google.ca/" />
		<test url="http://finance.google.com/" />
		<test url="http://finance.google.com.au/" />
		<test url="http://groups.google.ca/" />
		<test url="http://groups.google.com/" />
		<test url="http://groups.google.com.au/" />
		<test url="http://id.google.ca/" />
		<test url="http://id.google.com/" />
		<test url="http://id.google.com.au/" />
		<test url="http://lh3.google.ca/" />
		<test url="http://lh4.google.com/" />
		<test url="http://lh5.google.com.au/" />
		<test url="http://m.google.ca/" />
		<test url="http://m.google.com/" />
		<test url="http://m.google.com.au/" />
		<test url="http://picasaweb.google.ca/" />
		<test url="http://picasaweb.google.com/" />
		<test url="http://picasaweb.google.com.au/" />

	<rule from="^http://scholar\.google\.((?:com?\.)?\w{2,3})/intl/"
		to="https://www.google.$1/intl/" />
		<test url="http://scholar.google.ca/intl/" />
		<test url="http://scholar.google.com/intl/" />
		<test url="http://scholar.google.com.au/intl/" />

	<rule from="^http://news\.google\.(?:com?\.)?\w{2,3}/(?:$|news|newshp)"
		to="https://www.google.com/news" />

	<!-- subdomain to path redirects -->
	<rule from="^http://(earth|trends)\.google\.com/"
		 to="https://www.google.com/$1" />
		<test url="http://earth.google.com/" />
		<test url="http://trends.google.com/" />

	<!-- wildcards -->

	<rule from="^http://([^@:\./]+)\.googleusercontent\.com/"
		to="https://$1.googleusercontent.com/" />
		<test url="http://webcache.googleusercontent.com/" />
		<test url="http://foo.googleusercontent.com/" />
		<test url="http://bar.googleusercontent.com/" />

	<rule from="^http://([^/:@\.]+\.)?googlecode\.com/"
		 to="https://$1googlecode.com/" />
		<test url="http://foo.googlecode.com/" />
		<test url="http://bar.googlecode.com/" />
		<test url="http://www.googlecode.com/" />

	<rule from="^http://([^@:\./]+\.)?googlesource\.com/"
		to="https://$1googlesource.com/" />
		<test url="http://foo.googlesource.com/" />
		<test url="http://bar.googlesource.com/" />
		<test url="http://www.googlesource.com/" />

	<!-- Problems -->
		<!--
			https://www.google.com.au/tisp/	200 (OK)
			https://www.google.com.au/tisp	404
			https://www.google.com/tisp		404
			http://www.google.com/tisp		301 (redirect)
					-->
		<rule from="^https?://(?:www\.)?google\.((?:com?\.)?\w{2,3})/tisp(?=$|\?)"
			to="https://www.google.$1/tisp/" />
			<test url="https://www.google.com.au/tisp/" />
			<test url="https://www.google.com.au/tisp" />
			<test url="https://www.google.com/tisp" />
			<test url="http://www.google.com/tisp" />

		<!--	Paths that 404 on .ccltd, but work on .com:
									-->
		<rule from="^https?://(?:www\.)?google\.(?:com?\.)?\w{2,3}/(?=calendar|dictionary|doubleclick|foobar|help|ideas|pacman|partners|postini|powermeter|url|webdesigner)"
			 to="https://www.google.com/" />
</ruleset>
