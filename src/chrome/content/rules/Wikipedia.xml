<!-- Wikipedia and other Wikimedia Foundation wikis previously had no real HTTPS support, and
     URLs had to be rewritten to https://secure.wikimedia.org/$wikitype/$language/ . This is no
     longer the case, see [TODO link to Ryan's blog post when published], so this file is a lot
     simpler these days. -->

<ruleset name="Wikipedia">
  <target host="*.wikipedia.org" />
  <target host="*.wikinews.org" />
  <target host="*.wikisource.org" />
  <target host="*.wikibooks.org" />
  <target host="*.wikiquote.org" />
  <target host="*.wikiversity.org" />
  <target host="*.wiktionary.org" />
  <target host="wikipedia.org" />
  <target host="wikinews.org" />
  <target host="wikisource.org" />
  <target host="wikibooks.org" />
  <target host="wikiquote.org" />
  <target host="wikiversity.org" />
  <target host="wiktionary.org" />
  <target host="mediawiki.org" />
  <target host="www.mediawiki.org" />
  <target host="wikimediafoundation.org" />
  <target host="www.wikimediafoundation.org" />
  <target host="*.wikimedia.org" />
  <target host="wikimedia.org" />
  <target host="enwp.org" />

<!-- TODO: What exclusions do we need for mobile sites, if any? -->
  <exclusion pattern="^http://(dumps|download)\.wikimedia\.org/"/>
  <exclusion pattern="^http://(static|download|m)\.wikipedia\.org/"/>

<!-- The mediazilla: interwiki prefix on a default MediaWiki installation
     is outdated, wrongly pointing to http://bugzilla.wikipedia.org
     which is normally a (vulnerable) redirect.
     This has been corrected on Wikimedia Foundation wikis. -->
  <rule from="^http://bugzilla\.wiki[mp]edia\.org/"
          to="https://bugzilla.wikimedia.org/"/>

  <rule from="^http://([^@:/]+\.)?wik(ipedia|inews|isource|ibooks|iquote|iversity|tionary)\.org/"
          to="https://$1wik$2.org/" />

  <rule from="^http://(meta|commons|incubator|species|outreach|strategy|usability|wikimania|wikimania200[5-9]|wikimania201[0-2]|test)\.wikimedia\.org/"
	  to="https://$1.wikimedia.org/"/>
  

  <rule from="^http://(www\.)?mediawiki\.org/" 
	  to="https://$1mediawiki.org/" />
  <rule from="^http://(www\.)?wikimediafoundation\.org/" 
	  to="https://$1wikimediafoundation.org/" />

<!-- portal containing links to the English versions of all projects -->
  <rule from="^http://(www\.)wikimedia\.org/$"
          to="https://secure.wikimedia.org/" />
	
  <rule from="^http://(www\.)?(bits|upload)\.wikimedia\.org/"
   	  to="https://$2.wikimedia.org/"/>
  <rule from="^http://geoiplookup\.wikimedia\.org/"
	  to="https://geoiplookup.wikimedia.org/"/>
  <rule from="^http://survey\.wikimedia\.org/"
	  to="https://survey.wikimedia.org/" />
  <rule from="^http://enwp\.org/"
	  to="https://en.wikipedia.org/" />
</ruleset>
