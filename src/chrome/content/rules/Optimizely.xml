<!--
	CDN buckets:

		- d1qmdf3vop2l07.cloudfront.net
		- cdn.optimizely.com.edgekey.net	← cdn3


	Nonfunctional hosts in *optimizely.com:

		- pages ᵃ

	ᵃ Marketo / shows another domain


	Problematic hosts in *optimizely.com:

		- cdn4 ᴬ
		- support ᵈ
		- log3 ᵐ

	ᴬ Akamai / mismatched
	ᵈ Dropped, preemptable redirect
	ᵐ Mismatched


	Insecure cookies are set for these hosts: ᶜ

		- community.optimizely.com
		- learn.optimizely.com

	ᶜ See https://owasp.org/index.php/SecureFlag


	cdn sets the following insecure wildcard cookies
	on whichever domain it is loaded from:

		- optimizelyBuckets
		- optimizelyEndUserId
		- optimizelyPendingLogEvents
		- optimizelySegments

-->
<ruleset name="Optimizely (partial)">

	<!--	Direct rewrites:
				-->
	<target host="optimizely.com" />
	<target host="cdn.optimizely.com" />
	<target host="cdn2.optimizely.com" />
	<target host="cdn3.optimizely.com" />
	<target host="log.optimizely.com" />
	<target host="*.log.optimizely.com" />
	<target host="www.optimizely.com" />

		<exclusion pattern="^http://(?:[^./]+\.){2,}log\.optimizely\.com/" />

			<!--	+ve:
					-->
			<test url="http://this.host.log.optimizely.com/" />
			<test url="http://exists.not.log.optimizely.com/" />

		<test url="http://cdn.optimizely.com/js/geo2.js" />
		<test url="http://cdn2.optimizely.com/js/geo2.js" />
		<test url="http://cdn3.optimizely.com/js/geo2.js" />

	<!--	Complications:
				-->
	<target host="log3.optimizely.com" />


	<!--	Not secured by server:
					-->
	<!--securecookie host="^community\.optimizely\.com$" name="^Lithium(?:UserInfo|UserSecure|Visitor)$" /-->
	<!--securecookie host="^learn\.optimizely\.com$" name="^(?:YII_CSRF_TOKEN|backend_us_east_1)$" /-->

	<securecookie host="." name="." />


	<rule from="^http://log3\.optimizely\.com/"
		to="https://3.log.optimizely.com/" />

	<rule from="^http:"
		to="https:" />

</ruleset>
