<!--
	For problematic rules, see DailyKos.com-problematic.xml.


	CDN buckets:

		- s3.amazonaws.com/dk-production/
		- 1783-images-dailykos-com.voxcdn.com


	Nonfunctional subdomains:

		- comics	(cert: www; 307s to http)
		- elections	(cert: www; 307s to http)
		- labor		(cert: www; 301s to http)

-->
<ruleset name="Dailykos (buggy)" default_off="Breaks commenting and polls">

	<target host="dailykos.com" />
	<target host="*.dailykos.com" />
		<!--
			Lulz. Many account-related pages 307 to http.


			These paths 307 to http:

				- $
				- blog$
				- blog/\w+$
				- contactus$
				- diaries$
				- group$
				- group/
				- groups$
				- groups/$
				- news$
				- news/\w[^/]*$
				- newuser$
				- part/user/popup/login$
				- people$
				- people/$
				- special/media$
				- story/\d{4}/\d\d/\d\d/
				- user$
				- user/


			These paths do not:

				- accounts$
				- assets/
				- c/
				- donate$
				- favicon.ico
				- helpdesk_redirect$
				- i/
				- j/
				- images/
				- login$
				- signup$
				- subscribe$
				- users/password/new$
				- users/sign_in


			- These paths 403:

				- newthread/\w+

			- These paths 404:

				- jobs$
				- masthead$
				- privacy$

							-->
		<exclusion pattern="^http://(?:www\.)?dailykos\.com/(?:$|\?|blog|contactus|diaries|groups?|jobs|masthead|new(?:s|thread|user)|part/user/popup/login|people|privacy|special|story|user)(?:$|\?|/)" />
		<!--exclusion pattern="^http://(?:www\.)?dailykos\.com/+(?!(?:accounts|assets|c|donate|helpdesk_redirect|i|images|login|signup|subscribe|users)(?:$|[?/])|favicon\.ico)" /-->
		<!--
			404s.
				-->
		<!--exclusion pattern="^http://images[12]?\.dailykos\.com/(?:assets|images)/" /-->
		<!--
			Exceptions:
					-->
		<exclusion pattern="^http://images[12]?\.dailykos\.com/+(?!i/)" />


	<rule from="^http://(www\.)?dailykos\.com/"
		to="https://$1dailykos.com/" />


	<!--	At least some pages 404.
					-->
	<rule from="^http://campaigns\.dailykos\.com/(dia|o|salsa)/"
		to="https://kos.salsalabs.com/$1/" />

	<rule from="^http://helpdesk\.dailykos\.com/(help|pkg|stylesheets)/"
		to="https://dailykos.tenderapp.com/$1/" />

	<rule from="^http://images[12]?\.dailykos\.com/"
		to="https://www.dailykos.com/" />

	<!--	- i/ 301s to images
		- c/ & j/ do not
				-->
	<rule from="^http://(?:comics|elections|labor)\.dailykos\.com/([cij])/"
		to="https://www.dailykos.com/$1/" />

	<!--	Doesn't fix login popout.

	<rule from="^https://www\.dailykos\.com/j/([\w\-]+)\.js($|\?)"
		to="http://www.dailykos.com/j/$1.js$2" downgrade="1" /-->

</ruleset>
